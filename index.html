<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë§í•´ë³´ì¹´ S2 â€” Structure Recall</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=DM+Mono:wght@400;500&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#08080e;--surface:#111118;--surface2:#1a1a26;
  --border:#252535;--accent:#c8a96e;--accent2:#7c6fcd;
  --text:#e4e4f0;--muted:#686890;
  --ok:#5cb88a;--err:#e06c75;--r:14px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;min-height:100vh;display:flex;align-items:flex-start;justify-content:center}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 70% 50% at 15% 5%,rgba(124,111,205,.13) 0%,transparent 55%),radial-gradient(ellipse 50% 60% at 85% 95%,rgba(200,169,110,.11) 0%,transparent 55%);pointer-events:none;z-index:0}
.app{position:relative;z-index:1;width:100%;max-width:700px;padding:20px 16px 40px;min-height:100vh;display:flex;flex-direction:column;gap:0}
.screen{display:none;flex-direction:column;gap:18px;flex:1}
.screen.active{display:flex}

/* â”€â”€ HOME â”€â”€ */
.home-header{text-align:center;padding:36px 0 16px}
.eyebrow{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.25em;color:var(--muted);text-transform:uppercase;margin-bottom:10px}
.home-header h1{font-family:'Playfair Display',serif;font-size:clamp(30px,8vw,50px);line-height:1.1}
.home-header h1 em{font-style:italic;color:var(--accent)}
.home-header p{margin-top:10px;font-size:13px;color:var(--muted);line-height:1.6}
.task-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.task-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:24px 18px;cursor:pointer;transition:all .25s;position:relative;overflow:hidden}
.task-card::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity .3s}
.task-card.a::before{background:linear-gradient(135deg,rgba(124,111,205,.18),transparent)}
.task-card.b::before{background:linear-gradient(135deg,rgba(200,169,110,.18),transparent)}
.task-card:hover{transform:translateY(-3px);border-color:var(--muted)}
.task-card:hover::before{opacity:1}
.task-card .tag{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.2em;text-transform:uppercase;padding:3px 8px;border-radius:4px;display:inline-block;margin-bottom:12px}
.task-card.a .tag{background:rgba(124,111,205,.2);color:var(--accent2)}
.task-card.b .tag{background:rgba(200,169,110,.2);color:var(--accent)}
.task-card h2{font-family:'Playfair Display',serif;font-size:17px;line-height:1.3;margin-bottom:5px}
.task-card p{font-size:12px;color:var(--muted);line-height:1.5}
.task-card .cnt{margin-top:14px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)}
.settings{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:18px}
.settings h3{font-size:11px;font-family:'DM Mono',monospace;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:14px}
.srow{display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--border);gap:12px}
.srow:last-child{border-bottom:none}
.slabel{font-size:13px;color:var(--text)}
.ssub{font-size:11px;color:var(--muted);margin-top:1px}
.tgroup{display:flex;background:var(--bg);border:1px solid var(--border);border-radius:8px;overflow:hidden;flex-shrink:0}
.tbtn{padding:5px 11px;font-size:11px;font-family:'DM Mono',monospace;border:none;background:transparent;color:var(--muted);cursor:pointer;transition:all .2s}
.tbtn.on{background:var(--accent2);color:#fff}
.tbtn.on.gold{background:var(--accent);color:var(--bg)}

/* â”€â”€ QUIZ â”€â”€ */
.qheader{display:flex;align-items:center;justify-content:space-between;padding:6px 0}
.backbtn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:20px;padding:4px 8px;border-radius:8px;transition:color .2s}
.backbtn:hover{color:var(--text)}
.pinfo{font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);text-align:center}
.pinfo .cur{color:var(--text);font-size:15px;font-weight:600}
.mbadge{font-family:'DM Mono',monospace;font-size:10px;padding:4px 8px;border-radius:6px;background:var(--surface2);color:var(--muted);letter-spacing:.08em}
.pbar-wrap{height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.pbar-fill{height:100%;background:linear-gradient(90deg,var(--accent2),var(--accent));border-radius:2px;transition:width .4s ease}

.card{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:28px 26px;display:flex;flex-direction:column;gap:14px;position:relative;overflow:hidden;animation:cardIn .35s cubic-bezier(.34,1.56,.64,1)}
@keyframes cardIn{from{opacity:0;transform:translateY(18px) scale(.97)}to{opacity:1;transform:none}}
.card::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--accent2),transparent);opacity:.45}

.cmeta{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.ctype{font-family:'DM Mono',monospace;font-size:10px;padding:3px 7px;border-radius:4px;letter-spacing:.08em;text-transform:uppercase}
.ct-a{background:rgba(124,111,205,.2);color:var(--accent2)}
.ct-b{background:rgba(200,169,110,.2);color:var(--accent)}
.csec{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)}
.bmkbtn{background:none;border:none;font-size:17px;cursor:pointer;padding:3px;color:var(--muted);transition:all .2s;line-height:1;margin-left:auto}
.bmkbtn.on{color:var(--accent)}

/* ì¹´ë“œ ë³¸ë¬¸ */
.cq{font-size:13px;color:var(--muted);margin-bottom:4px;line-height:1.5}
.cprompt{font-size:15px;line-height:2.2;color:var(--text)}
.red-blank{
  display:inline-block;background:rgba(224,108,117,.12);
  border:1.5px dashed rgba(224,108,117,.6);border-radius:6px;
  padding:1px 10px;min-width:90px;color:#e06c75;
  font-family:'DM Mono',monospace;font-size:13px;font-style:italic;
  transition:all .3s;vertical-align:middle;
}
.red-blank.filled{background:rgba(92,184,138,.12);border:1.5px solid var(--ok);color:var(--ok);font-style:normal}
.red-blank.wrong{background:rgba(224,108,117,.12);border:1.5px solid var(--err);color:var(--err);font-style:normal}

/* task b: keyword blank */
.kw-blank{
  display:inline-block;background:var(--surface2);
  border:1.5px solid var(--accent2);border-radius:6px;
  padding:1px 10px;min-width:70px;color:var(--accent2);
  font-family:'DM Mono',monospace;font-size:13px;font-style:italic;
  transition:all .3s;vertical-align:middle;
}
.kw-blank.filled{background:rgba(92,184,138,.12);border-color:var(--ok);color:var(--ok);font-style:normal}
.kw-blank.wrong{background:rgba(224,108,117,.12);border-color:var(--err);color:var(--err);font-style:normal}

.tip-box{background:rgba(200,169,110,.07);border:1px solid rgba(200,169,110,.2);border-radius:8px;padding:10px 13px;font-size:12px;color:var(--accent);line-height:1.6}

/* input / buttons */
.iarea{display:flex;flex-direction:column;gap:9px}
.ainput{width:100%;background:var(--surface2);border:1.5px solid var(--border);border-radius:10px;padding:11px 14px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:14px;outline:none;transition:border-color .2s;resize:none}
.ainput:focus{border-color:var(--accent2)}
.ainput.ok{border-color:var(--ok);background:rgba(92,184,138,.07)}
.ainput.ng{border-color:var(--err);background:rgba(224,108,117,.07)}
.brow{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.btn{padding:11px 14px;border-radius:10px;font-size:13px;font-family:'Noto Sans KR',sans-serif;font-weight:500;border:none;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:5px}
.btn:active{transform:scale(.97)}
.btn-pri{background:var(--accent2);color:#fff;grid-column:1/-1}
.btn-pri:hover{filter:brightness(1.15)}
.btn-sec{background:var(--surface2);border:1px solid var(--border);color:var(--muted)}
.btn-sec:hover{border-color:var(--muted);color:var(--text)}
.btn-gold{background:var(--accent);color:var(--bg);font-weight:700;grid-column:1/-1}
.btn-gold:hover{filter:brightness(1.1)}

/* feedback */
.fb{border-radius:10px;padding:13px 15px;font-size:13px;line-height:1.7;display:none;animation:fbin .3s ease}
@keyframes fbin{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:none}}
.fb.show{display:block}
.fb.ok-fb{background:rgba(92,184,138,.09);border:1px solid rgba(92,184,138,.3)}
.fb.ng-fb{background:rgba(224,108,117,.09);border:1px solid rgba(224,108,117,.3)}
.fb-lbl{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:5px}
.fb-txt{color:var(--text);font-size:14px;line-height:1.8}
.hl{color:var(--accent);font-weight:700}

.hint-txt{font-family:'DM Mono',monospace;font-size:12px;color:var(--accent);padding:8px 12px;background:rgba(200,169,110,.07);border-radius:8px;border:1px solid rgba(200,169,110,.2);display:none}
.hint-txt.show{display:block}

/* â”€â”€ TTS â”€â”€ */
.tts-bar{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px}
.tts-btn{background:none;border:none;cursor:pointer;font-size:18px;line-height:1;padding:2px 4px;border-radius:6px;transition:all .2s;color:var(--muted);flex-shrink:0}
.tts-btn:hover{color:var(--text);background:var(--border)}
.tts-btn.playing{color:var(--accent2);animation:pulse 1.2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.tts-label{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);flex:1;letter-spacing:.05em}
.tts-speed{display:flex;gap:4px}
.tts-speed button{padding:3px 7px;font-size:10px;font-family:'DM Mono',monospace;border:1px solid var(--border);border-radius:5px;background:transparent;color:var(--muted);cursor:pointer;transition:all .15s}
.tts-speed button.on{background:var(--accent2);border-color:var(--accent2);color:#fff}

/* â”€â”€ RESULT â”€â”€ */
.result{text-align:center;display:flex;flex-direction:column;gap:18px;flex:1;padding:16px 0}
.result h1{font-family:'Playfair Display',serif;font-size:38px}
.result .rsub{color:var(--muted);font-size:13px}
.sgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.scard{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px 10px}
.scard .sv{font-family:'Playfair Display',serif;font-size:30px;color:var(--accent);display:block}
.scard .sk{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:3px}
.wlist{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:left;max-height:190px;overflow-y:auto}
.wlist h4{font-size:11px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.13em;margin-bottom:10px}
.wi{font-size:12px;color:var(--muted);padding:7px 0;border-bottom:1px solid var(--border);line-height:1.5}
.wi:last-child{border-bottom:none}
.wi-sec{color:var(--err);font-family:'DM Mono',monospace;font-size:10px;display:block;margin-bottom:2px}

::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
@media(max-width:480px){.task-grid{grid-template-columns:1fr}.card{padding:22px 16px}}
</style>
</head>
<body>
<div class="app">

<!-- â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="homeScreen">
  <div class="home-header">
    <div class="eyebrow">ë§í•´ë³´ì¹´ Â· S2 ì¸ì¶œí›ˆë ¨</div>
    <h1>Structure<br><em>Recall</em></h1>
    <p>ì„œë¡ /ë³¸ë¡ /ê²°ë¡  êµ¬ì¡°ë¥¼ ëª¸ìœ¼ë¡œ ìµíˆëŠ” ë¹ˆì¹¸ ì¸ì¶œ í›ˆë ¨</p>
  </div>
  <div class="task-grid">
    <div class="task-card a" onclick="startTask('A')">
      <div class="tag">Task A</div>
      <h2>ë²”ìš© í…œí”Œë¦¿</h2>
      <p>ğŸ”´ ìŠ¬ë¡¯ì„ ì±„ì›Œ ì–´ë–¤ ì£¼ì œì—ë„ ì ìš© ê°€ëŠ¥í•œ S2 êµ¬ì¡° ì™„ì„±</p>
      <div class="cnt" id="cntA">â€” ë¬¸í•­</div>
    </div>
    <div class="task-card b" onclick="startTask('B')">
      <div class="tag">Task B</div>
      <h2>Responsibility</h2>
      <p>ìƒˆë²½ ì„œë²„ì¥ì•  ì—ì„¸ì´ â€” í‚¤ì›Œë“œ ì¸ì¶œ í›ˆë ¨</p>
      <div class="cnt" id="cntB">â€” ë¬¸í•­</div>
    </div>
  </div>
  <div class="settings">
    <h3>âš™ ì¶œì œ ì„¤ì •</h3>
    <div class="srow">
      <div><div class="slabel">ì¶œì œ ìˆœì„œ</div><div class="ssub">ì¹´ë“œê°€ ë‚˜ì˜¤ëŠ” ìˆœì„œ</div></div>
      <div class="tgroup" id="og">
        <button class="tbtn on" data-v="seq" onclick="setSetting('order','seq',this)">ìˆœì„œ</button>
        <button class="tbtn" data-v="rev" onclick="setSetting('order','rev',this)">ì—­ìˆœ</button>
        <button class="tbtn" data-v="rnd" onclick="setSetting('order','rnd',this)">ëœë¤</button>
      </div>
    </div>
    <div class="srow">
      <div><div class="slabel">ì˜¤ë‹µ ì¬ì¶œì œ</div><div class="ssub">í‹€ë¦° ì¹´ë“œ ìë™ ì¬ì‹œë„</div></div>
      <div class="tgroup" id="rg">
        <button class="tbtn on gold" data-v="on" onclick="setSetting('retry','on',this)">ON</button>
        <button class="tbtn" data-v="off" onclick="setSetting('retry','off',this)">OFF</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="quizScreen">
  <div class="qheader">
    <button class="backbtn" onclick="goHome()">â†</button>
    <div class="pinfo"><span class="cur" id="pCur">1</span> / <span id="pTot">1</span></div>
    <span class="mbadge" id="mBadge">ìˆœì„œ</span>
  </div>
  <div class="pbar-wrap"><div class="pbar-fill" id="pBar" style="width:0%"></div></div>
  <div class="card" id="qCard">
    <div class="cmeta">
      <span class="ctype ct-a" id="cTypeBadge">Template</span>
      <span class="csec" id="cSec">ì„œë¡ </span>
      <button class="bmkbtn" id="bmkBtn" onclick="toggleBmk()">â˜†</button>
    </div>
    <div class="cq" id="cQ"></div>
    <div class="cprompt" id="cPrompt"></div>
    <div class="tip-box" id="tipBox" style="display:none"></div>
    <div class="hint-txt" id="hintTxt"></div>
    <div class="fb" id="fb"><div class="fb-lbl" id="fbLbl"></div><div class="fb-txt" id="fbTxt"></div></div>
    <!-- TTS bar: shown after answer revealed -->
    <div class="tts-bar" id="ttsBar" style="display:none">
      <button class="tts-btn" id="ttsPlayBtn" onclick="ttsToggle()" title="ë¬¸ì¥ ì½ê¸°">â–¶</button>
      <span class="tts-label" id="ttsLabel">ì •ë‹µ ë¬¸ì¥ ë“£ê¸°</span>
      <div class="tts-speed">
        <button onclick="setTtsRate(0.75,this)">0.75Ã—</button>
        <button class="on" onclick="setTtsRate(1,this)">1Ã—</button>
        <button onclick="setTtsRate(1.25,this)">1.25Ã—</button>
      </div>
    </div>
  <div class="iarea">
    <textarea class="ainput" id="aInp" rows="2" placeholder="ì •ë‹µ ì…ë ¥... (Enter ì œì¶œ, Shift+Enter ì¤„ë°”ê¿ˆ)" onkeydown="handleKey(event)"></textarea>
    <div class="brow" id="aBtns">
      <button class="btn btn-pri" onclick="checkAns()">âœ“ ì •ë‹µ í™•ì¸</button>
      <button class="btn btn-sec" onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
      <button class="btn btn-sec" onclick="skipCard()">ê±´ë„ˆë›°ê¸° â†’</button>
    </div>
    <div class="brow" id="nBtns" style="display:none">
      <button class="btn btn-gold" onclick="nextCard()">ë‹¤ìŒ ì¹´ë“œ â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="resultScreen">
  <div class="result">
    <div><h1 id="rEmoji">ğŸ¯</h1><h1 id="rTitle" style="font-size:28px;font-family:'Playfair Display',serif">ì™„ë£Œ!</h1><p class="rsub" id="rSub"></p></div>
    <div class="sgrid">
      <div class="scard"><span class="sv" id="sOk">0</span><div class="sk">ì •ë‹µ</div></div>
      <div class="scard"><span class="sv" id="sNg">0</span><div class="sk">ì˜¤ë‹µ</div></div>
      <div class="scard"><span class="sv" id="sRate">0%</span><div class="sk">ì •í™•ë„</div></div>
    </div>
    <div class="wlist" id="wList" style="display:none"><h4>ì˜¤ë‹µ ëª©ë¡</h4><div id="wItems"></div></div>
    <div style="display:flex;flex-direction:column;gap:9px">
      <button class="btn btn-gold" id="retryWBtn" onclick="retryWrong()" style="display:none">ì˜¤ë‹µë§Œ ë‹¤ì‹œ í’€ê¸°</button>
      <button class="btn btn-pri" onclick="retryAll()">ì „ì²´ ë‹¤ì‹œ í’€ê¸°</button>
      <button class="btn btn-sec" onclick="goHome()">ë©”ì¸ìœ¼ë¡œ</button>
    </div>
  </div>
</div>

</div><!-- .app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TASK A â€” ë²”ìš© S2 í…œí”Œë¦¿ (ğŸ”´ ìŠ¬ë¡¯ ì¸ì¶œ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DECK_A = [
  // â”€â”€ ì„œë¡  â”€â”€
  {
    section:"ì„œë¡  â‘ ",
    q:"ì£¼ì œë¥¼ ë‹¨ìˆœ ì´ë¶„ë²•ìœ¼ë¡œ ê°€ë‘¬ë‘ì§€ ì•ŠëŠ” ì˜¤í”„ë‹ â€” TOPIC, A/B ëŒ€ë¦½, í•µì‹¬ tensionì€?",
    prompt:"The question of ğŸ”´[TOPIC] is often framed as a simple dichotomy (ğŸ”´[A] vs. ğŸ”´[B]), yet this binary obscures a more fundamental ã€___ã€‘.",
    blanks:["tension"],
    answer:"tension",
    full:"The question of [TOPIC] is often framed as a simple dichotomy ([A] vs. [B]), yet this binary obscures a more fundamental tension.",
    hint:"ë‹¨ìˆœ ì´ë¶„ë²•ì´ ê°€ë¦¬ëŠ” ê²ƒ â†’ t____n"
  },
  {
    section:"ì„œë¡  â‘¡",
    q:"ì´ ë…¼ìŸì´ ì‚¬íšŒì •ì¹˜ì  ë§¥ë½ ì†ì— ê¹Šì´ ë°•í˜€ ìˆìŒì„ ë³´ì—¬ì£¼ëŠ” ë°°ê²½ ë¬¸ì¥ì€?",
    prompt:"This debate does not exist in ã€___ã€‘; it is deeply ã€___ã€‘ in the socio-political reality of ğŸ”´[CONTEXT].",
    blanks:["isolation","embedded"],
    answer:"isolation / embedded",
    full:"This debate does not exist in isolation; it is deeply embedded in the socio-political reality of [CONTEXT].",
    hint:"ê³ ë¦½ / ë‚´ì¬ëœ"
  },
  {
    section:"ì„œë¡  â‘¢",
    q:"ì£¼ì œê°€ ì–‘ë‚ ì˜ ê²€ì„ì„ ë“œëŸ¬ë‚´ëŠ” thesis â€” í‘œë©´ì  ì´ë“ê³¼ ì‹¬ì¸µì  í•´ì•…ì˜ ì—­ì„¤ì€?",
    prompt:"Unchecked commitment to ğŸ”´[POLICY] carries an ã€___ã€‘ paradox â€” it may ğŸ”´[SURFACE BENEFIT] while quietly ğŸ”´[DEEP HARM].",
    blanks:["uncomfortable"],
    answer:"uncomfortable",
    full:"Unchecked commitment to [POLICY] carries an uncomfortable paradox â€” it may [SURFACE BENEFIT] while quietly [DEEP HARM].",
    hint:"'ë¶ˆí¸í•œ ì—­ì„¤' â€” u__________e"
  },
  {
    section:"ì„œë¡  â‘£",
    q:"The central question í”„ë ˆì„ â€” ê°€ì¹˜ ì—¬ë¶€ê°€ ì•„ë‹ˆë¼ ë” ê¹Šì€ ì˜ë¬´ ì•ì—ì„œ ì •ë‹¹í™”ë  ìˆ˜ ìˆëŠ”ê°€?",
    prompt:"The central question, then, is not whether ğŸ”´[TOPIC] has value, but whether it can be ã€___ã€‘ before ğŸ”´[DEEPER OBLIGATION] is met.",
    blanks:["justified"],
    answer:"justified",
    full:"The central question, then, is not whether [TOPIC] has value, but whether it can be justified before [DEEPER OBLIGATION] is met.",
    hint:"ì •ë‹¹í™”ë  ìˆ˜ ìˆëŠ”ê°€ â€” j________d"
  },

  // â”€â”€ ë³¸ë¡  1 â”€â”€
  {
    section:"ë³¸ë¡ 1 â‘ ",
    q:"ì‹œìŠ¤í…œì  ë¬¸ì œëŠ” ì‹œìŠ¤í…œì  í•´ê²°ì±…ì´ í•„ìš”í•˜ë‹¤ â€” ë³¸ë¡ 1 ì‹œì‘ ë¬¸ì¥ + ì‚°ì—…í˜ëª… ë„ì…ì€?",
    prompt:"Central to this issue is the recognition that ã€___ã€‘ problems demand ã€___ã€‘ solutions. History offers an uncomfortable mirror in the form of the Industrial Revolution.",
    blanks:["systemic","systemic"],
    answer:"systemic / systemic",
    full:"Central to this issue is the recognition that systemic problems demand systemic solutions. History offers an uncomfortable mirror in the form of the Industrial Revolution.",
    hint:"êµ¬ì¡°ì /ì‹œìŠ¤í…œì  â€” s______c"
  },
  {
    section:"ë³¸ë¡ 1 â‘¡",
    q:"ì‚°ì—…í˜ëª… ë‹¹ì‹œ íš¨ìœ¨ ì¶”êµ¬ê°€ ì¸ê°„ì„ 'í†±ë‹ˆë°”í€´'ë¡œ ë§Œë“¤ì—ˆë‹¤ â€” ë¹ˆì¹¸ í‘œí˜„ì€?",
    prompt:"The relentless pursuit of ğŸ”´[PARALLEL] reduced human workers to mere ã€___ã€‘ â€” expendable, invisible, replaceable.",
    blanks:["cogs in a machine"],
    answer:"cogs in a machine",
    full:"The relentless pursuit of [PARALLEL] reduced human workers to mere 'cogs in a machine' â€” expendable, invisible, replaceable.",
    hint:"ê¸°ê³„ì˜ í†±ë‹ˆë°”í€´ â€” c___ in a m_____e"
  },
  {
    section:"ë³¸ë¡ 1 â‘¢",
    q:"ì—­ì‚¬ì  íŒ¨í„´ì´ ì˜¤ëŠ˜ë‚  ë°˜ë³µëœë‹¤ â€” 'í˜„ëŒ€ í”¼í•´ì'ë¥¼ ìƒì‚°í•˜ëŠ” ë¹„ìœ  ë¬¸ì¥ì€?",
    prompt:"Just as industrialisation produced human waste alongside material wealth, our current system ã€___ã€‘ ğŸ”´[MODERN VICTIMS].",
    blanks:["manufactures"],
    answer:"manufactures",
    full:"Just as industrialisation produced human waste alongside material wealth, our current system manufactures [MODERN VICTIMS].",
    hint:"ìƒì‚°/ì–‘ì‚°í•˜ë‹¤ â€” m___________s"
  },
  {
    section:"ë³¸ë¡ 1 â‘£ â€” ğŸ”‘ Punchline",
    q:"'broken cogs vs. broken machine' ë¹„ìœ ë¡œ í”¼ìƒì  í•´ê²°ì±…ì„ ë¹„íŒí•˜ëŠ” ì†Œê²°ë¡  + í€ì¹˜ë¼ì¸ì€?",
    prompt:"By focusing solely on ğŸ”´[SUPERFICIAL SOLUTION], we discard the 'ã€___ã€‘' (victims) while leaving intact the 'ã€___ã€‘' (root cause) that created them.\nğŸ”´[PUNCHLINE: Treating X while ignoring Y is not Z â€” it is DAMNING REFRAME.]",
    blanks:["broken cogs","broken machine"],
    answer:"broken cogs / broken machine",
    full:"By focusing solely on [SUPERFICIAL SOLUTION], we discard the 'broken cogs' while leaving intact the 'broken machine' that created them.",
    hint:"ë§ê°€ì§„ í†±ë‹ˆë°”í€´ / ë§ê°€ì§„ ê¸°ê³„"
  },

  // â”€â”€ ë³¸ë¡  2 â”€â”€
  {
    section:"ë³¸ë¡ 2 â‘ ",
    q:"ë°˜ë¡ ì„ ìˆ˜ìš©í•˜ë©´ì„œë„ ì§€ì  ì •ì§ì„±ì„ ê°•ì¡°í•˜ëŠ” ì–‘ë³´ ë¬¸ì¥ â€” í•µì‹¬ ì–´êµ¬ëŠ”?",
    prompt:"Admittedly, proponents argue that ğŸ”´[COUNTER], and there is some validity to this claim. It would be ã€___ã€‘ to dismiss ğŸ”´[GENUINE BENEFIT] entirely.",
    blanks:["intellectually dishonest"],
    answer:"intellectually dishonest",
    full:"Admittedly, proponents argue that [COUNTER], and there is some validity to this claim. It would be intellectually dishonest to dismiss [GENUINE BENEFIT] entirely.",
    hint:"ì§€ì ìœ¼ë¡œ ë¶€ì •ì§í•œ â€” i__________ly d______t"
  },
  {
    section:"ë³¸ë¡ 2 â‘¡",
    q:"ë¡¤ìŠ¤ì˜ 'ë¬´ì§€ì˜ ë² ì¼' â€” ì–´ë–¤ ì¡°ê±´ í•˜ì—ì„œ ì–´ë–¤ êµ¬ì¡°ë¥¼ ì§€ì§€í•˜ì§€ ì•Šì„ ê²ƒì¸ê°€?",
    prompt:"John Rawls' ã€___ã€‘ demands that just institutions be designed without knowledge of one's own position in society. Under this constraint, no rational agent would endorse a structure where ğŸ”´[UNCONTROLLABLE FACTOR] predetermines ğŸ”´[LIFE OUTCOME], effectively ã€___ã€‘ inequality as policy.",
    blanks:["Veil of Ignorance","codifying"],
    answer:"Veil of Ignorance / codifying",
    full:"John Rawls' Veil of Ignorance demands that just institutions be designed without knowledge of one's own position. No rational agent would endorse a structure that effectively codifies inequality as policy.",
    hint:"ë¬´ì§€ì˜ ë² ì¼ / ë²•ì œí™”í•˜ë‹¤ â€” c______g"
  },
  {
    section:"ë³¸ë¡ 2 â‘¢ â€” ğŸ”‘ Punchline",
    q:"'ìš´ì˜ ìì˜ì„±'ê³¼ 'êµ­ê°€ ìŠ¹ì¸ ì”í˜¹ì„±' â€” ë³¸ë¡ 2 ìµœì¢… í€ì¹˜ë¼ì¸ ë‘ ë¬¸ì¥ì€?",
    prompt:"True justice is not merely about ğŸ”´[SUPERFICIAL ACTION] â€” it is about ensuring that ğŸ”´[UNCONTROLLABLE FACTOR] does not ã€___ã€‘ ğŸ”´[OUTCOME].\nTo ğŸ”´[BLAME] those with no power to choose otherwise is not justice â€” it is ã€___ã€‘.",
    blanks:["dictate","state-sanctioned cruelty"],
    answer:"dictate / state-sanctioned cruelty",
    full:"True justice ensures that [UNCONTROLLABLE FACTOR] does not dictate [OUTCOME]. To [BLAME] those with no power to choose otherwise is not justice â€” it is state-sanctioned cruelty.",
    hint:"ê²°ì •ì§“ë‹¤ / êµ­ê°€ ìŠ¹ì¸ ì”í˜¹ì„± â€” s_________d c_____y"
  },

  // â”€â”€ ê²°ë¡  â”€â”€
  {
    section:"ê²°ë¡  â‘ ",
    q:"ì´ ë‹´ë¡ ì´ ìš°ë¦¬ì˜ ì§‘ë‹¨ì  ê°€ì¹˜ë¥¼ ë°˜ì˜í•œë‹¤ â€” ì •ì˜ë¡œìš´ ì‚¬íšŒì˜ ì§„ì§œ ì²™ë„ëŠ”?",
    prompt:"In the final analysis, the discourse surrounding ğŸ”´[TOPIC] is a reflection of our ã€___ã€‘ values. A just society is not measured by ğŸ”´[SUPERFICIAL METRIC], but by how it treats those with the ã€___ã€‘ to shape it.",
    blanks:["collective","least power"],
    answer:"collective / least power",
    full:"In the final analysis, the discourse surrounding [TOPIC] is a reflection of our collective values. A just society is not measured by [SUPERFICIAL METRIC], but by how it treats those with the least power to shape it.",
    hint:"ì§‘ë‹¨ì  / ê°€ì¥ ì ì€ ê¶Œë ¥"
  },
  {
    section:"ê²°ë¡  â‘¡ â€” ğŸ”‘ ìµœì¢… í†µì°°",
    q:"Wrong Question â†’ Right Question í”„ë ˆì„ ì „í™˜ â€” ê²°ë¡  ë§ˆë¬´ë¦¬ ë¬¸ì¥ì€?",
    prompt:"The question is not 'ğŸ”´[WRONG QUESTION]?' but 'ğŸ”´[RIGHT QUESTION]?' Until we answer the latter with ã€___ã€‘, the former remains a ã€___ã€‘.",
    blanks:["conviction","moral distraction"],
    answer:"conviction / moral distraction",
    full:"The question is not '[WRONG QUESTION]?' but '[RIGHT QUESTION]?' Until we answer the latter with conviction, the former remains a moral distraction.",
    hint:"í™•ì‹  / ë„ë•ì  ì‚°ë§Œí•¨ â€” m___l d_________n"
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TASK B â€” Responsibility ì—ì„¸ì´ (í‚¤ì›Œë“œ ë¹ˆì¹¸)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DECK_B = [
  // â”€â”€ ì„œë¡  â”€â”€
  {
    section:"ì„œë¡  â€” Re-definition â‘ ",
    q:"ì±…ì„ê°ì˜ 'ê³¼ê±° ì°©ê°' â€” noble + competent ì¡°í•©ìœ¼ë¡œ ìƒìƒí–ˆë‹¤ëŠ” ì˜¤í”„ë‹ì€?",
    prompt:"Reflecting on the theme of Responsibility, I once imagined it as something ã€___ã€‘ â€” an attribute worn proudly by those who had already become who they ã€___ã€‘ to be.",
    blanks:["noble","wanted"],
    answer:"noble / wanted",
    full:"Reflecting on the theme of Responsibility, I once imagined it as something noble â€” an attribute worn proudly by those who had already become who they wanted to be.",
    hint:"ê³ ê·€í•œ / wanted to be",
    tip:"ì˜¤í”„ë‹ì—ì„œ 'ì°©ê°'ì„ ë¨¼ì € ì„¤ì •í•´ì•¼ ë‚˜ì¤‘ ë°˜ì „ì´ ì‚´ì•„ë‚œë‹¤."
  },
  {
    section:"ì„œë¡  â€” Re-definition â‘¡",
    q:"ì±…ì„ê°ì´ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ë‚˜íƒ€ë‚˜ëŠ”ê°€ â€” 3ê°€ì§€ ì†ì„±ìœ¼ë¡œ ì¬ì •ì˜í•˜ëŠ” thesisëŠ”?",
    prompt:"Only later did I understand that Responsibility rarely ã€___ã€‘ itself with dignity. It arrives at ã€___ã€‘ hours, in ã€___ã€‘ forms, and asks something of us before we feel ready to give it.",
    blanks:["announces","inconvenient","unglamorous"],
    answer:"announces / inconvenient / unglamorous",
    full:"Only later did I understand that Responsibility rarely announces itself with dignity. It arrives at inconvenient hours, in unglamorous forms, and asks something of us before we feel ready to give it.",
    hint:"ì•Œë¦¬ë‹¤ / ë¶ˆí¸í•œ / í™”ë ¤í•˜ì§€ ì•Šì€",
    tip:"ë§ˆì§€ë§‰ 'asks something of us before we feel ready' ë¡œ ëë‚´ â€” ë…ìê°€ ë‹¤ìŒ ì´ì•¼ê¸°ë¥¼ ê¸°ëŒ€í•˜ê²Œ ë§Œë“œëŠ” í›…."
  },

  // â”€â”€ ë³¸ë¡  1 â”€â”€
  {
    section:"ë³¸ë¡ 1 â€” Incident â‘ ",
    q:"ìƒˆë²½ ì„œë²„ ì¥ì• ì˜ í’ê²½ â€” êµê³¼ì„œ, ì•Œë¦¼ìŒ, ë„ì‹œì˜ ì¹¨ë¬µìœ¼ë¡œ ê¸´ì¥ê° ì„¤ì •í•˜ëŠ” ë¬¸ì¥ë“¤ì€?",
    prompt:"One night, while preparing for the GAMSAT, a critical server failure struck at ã€___ã€‘ AM. My textbooks lay open across the desk, dense with notes that promised a ã€___ã€‘ future. The alert cut through the silence of my apartment like an ã€___ã€‘.",
    blanks:["1","different","accusation"],
    answer:"1 AM / different future / accusation",
    full:"One night, while preparing for the GAMSAT, a critical server failure struck at 1 AM. My textbooks lay open across the desk, dense with notes that promised a different future. The alert cut through the silence of my apartment like an accusation.",
    hint:"ìƒˆë²½ 1ì‹œ / ë‹¤ë¥¸ ë¯¸ë˜ / ê³ ë°œ(ë¹„ìœ )",
    tip:"'like an accusation' â€” ì•Œë¦¼ìŒì„ ê³ ë°œë¡œ í‘œí˜„. ì´ëŸ° ë¹„ìœ ê°€ 70+ ë§Œë“¤ì–´ì£¼ëŠ” ë¬¸ì¥."
  },
  {
    section:"ë³¸ë¡ 1 â€” Incident â‘¡",
    q:"ì†”ì§í•œ ê°ì • í† ë¡œ + 'But I would know' ë°˜ì „ â€” ê°€ì¥ ì§§ê³  ê°•í•œ ë‘ ë¬¸ì¥ì€?",
    prompt:"I did not feel ã€___ã€‘. I felt ã€___ã€‘. \u201cWhy now? Why must I sacrifice my future for a machine?\u201d\nI considered ignoring the alert. No one would know that I hesitated.\nã€___ã€‘.",
    blanks:["admirable","resentful","But I would know"],
    answer:"admirable / resentful / But I would know",
    full:"I did not feel admirable. I felt resentful. 'Why now? Why must I sacrifice my future for a machine?' No one would know that I hesitated. But I would know.",
    hint:"ì¡´ê²½ìŠ¤ëŸ¬ìš´ / ë¶„ê°œí•œ / But I would know",
    tip:"'But I would know.' ë¥¼ ë°˜ë“œì‹œ ë‹¨ë… ë¬¸ì¥ìœ¼ë¡œ ë¶„ë¦¬. ì§§ì€ ë¬¸ì¥ì´ ê¸´ ë‹¨ë½ë³´ë‹¤ ì±„ì ê´€ ê¸°ì–µì— í›¨ì”¬ ê°•í•˜ê²Œ ë‚¨ëŠ”ë‹¤."
  },

  // â”€â”€ ë³¸ë¡  2 â”€â”€
  {
    section:"ë³¸ë¡ 2 â€” Struggle â‘ ",
    q:"'ê°ì‹œë°›ì§€ ì•Šì„ ë•Œ ìš°ë¦¬ê°€ ëˆ„êµ¬ì¸ì§€'ê°€ ì±…ì„ê°ì˜ ë³¸ì§ˆ â€” í•µì‹¬ í†µì°° ë¬¸ì¥ì€?",
    prompt:"Responsibility, I was beginning to understand, is rarely about being ã€___ã€‘. It is about who we choose to be when ã€___ã€‘.",
    blanks:["watched","no one is"],
    answer:"watched / no one is",
    full:"Responsibility, I was beginning to understand, is rarely about being watched. It is about who we choose to be when no one is.",
    hint:"ì§€ì¼œë³¼ ë•Œê°€ ì•„ë‹ˆë¼ / ì•„ë¬´ë„ ì—†ì„ ë•Œ",
    tip:"ì´ ë¬¸ì¥ì´ ì—ì„¸ì´ ì „ì²´ì˜ í•µì‹¬ ì •ì˜. ì™¸ìš¸ ê²ƒ."
  },
  {
    section:"ë³¸ë¡ 2 â€” Struggle â‘¡",
    q:"ì§„ì§œ ì¥ì• ë¬¼ì€ ì„œë²„ê°€ ì•„ë‹ˆë¼ ë‚´ ì“´ ë§ˆìŒì´ì—ˆë‹¤ â€” ë°˜ì „ ë‘ ë¬¸ì¥ì€?",
    prompt:"The task itself was mechanical, almost ã€___ã€‘. Yet beneath it ran a quieter struggle â€” the decision to show up despite ã€___ã€‘.\nThe server was not the true obstacle. My ã€___ã€‘ was.",
    blanks:["mundane","resentment","bitterness"],
    answer:"mundane / resentment / bitterness",
    full:"The task itself was mechanical, almost mundane. Yet beneath it ran a quieter struggle â€” the decision to show up despite resentment. The server was not the true obstacle. My bitterness was.",
    hint:"í‰ë²”í•œ / ë¶„ê°œ / ì“´ ë§ˆìŒ",
    tip:"'The server was not the true obstacle. My bitterness was.' â€” ì´ ë°˜ì „ êµ¬ì¡°ê°€ 70+ì˜ í•µì‹¬."
  },
  {
    section:"ë³¸ë¡ 2 â€” Realisation",
    q:"ì±…ì„ê°ì˜ ì¬ì •ì˜ â€” 'ê±°ì°½í•œ í¬ìƒ'ì´ ì•„ë‹ˆë¼ 'ë°˜ë³µì ì´ê³  ê°ì‚¬ë°›ì§€ ëª»í•˜ëŠ” ì„ íƒ'ì´ë€ ë¬¸ì¥ì€?",
    prompt:"Responsibility is not the grand ã€___ã€‘ we imagine. It is the repeated, often ã€___ã€‘ choice to act in ã€___ã€‘ with our values, even when it costs us comfort.",
    blanks:["sacrifice","thankless","alignment"],
    answer:"sacrifice / thankless / alignment",
    full:"Responsibility, I realised, is not the grand sacrifice we imagine. It is the repeated, often thankless choice to act in alignment with our values, even when it costs us comfort.",
    hint:"í¬ìƒ / ê°ì‚¬ ì—†ëŠ” / ì •ë ¬"
  },

  // â”€â”€ ê²°ë¡  â”€â”€
  {
    section:"ê²°ë¡  â€” Doctor Link",
    q:"ì„œë²„ ì¥ì• ë¥¼ ë¯¸ë˜ì˜ ì˜ì‚¬ ìƒí™œë¡œ ì—°ê²°í•˜ëŠ” ë¸Œë¦¿ì§€ + ê°™ì€ ê°ì •ì´ ëŒì•„ì˜¬ ê²ƒì´ë¼ëŠ” ì†”ì§í•œ ì¸ì •ì€?",
    prompt:"Perhaps one day it will not be a ã€___ã€‘ but a ã€___ã€‘ who wakes me at 3 AM. I do not know whether I will feel ready. I suspect I may feel the same flicker of ã€___ã€‘, the same tired ã€___ã€‘.",
    blanks:["server","patient","resentment","resistance"],
    answer:"server / patient / resentment / resistance",
    full:"Perhaps one day it will not be a server but a patient who wakes me at 3 AM. I do not know whether I will feel ready. I suspect I may feel the same flicker of resentment, the same tired resistance.",
    hint:"ì„œë²„ â†’ í™˜ì / ë¶„ë…¸ / ì €í•­ê°",
    tip:"ë°˜ë“œì‹œ ì˜ì‚¬ ì—°ê²°ê³ ë¦¬ë¥¼ ë„£ì–´. ì±„ì ê´€ì´ 'ì´ ì‚¬ëŒì´ ì™œ ì˜ëŒ€ë¥¼ ê°€ë ¤ëŠ”ì§€' ìì—°ìŠ¤ëŸ½ê²Œ ëŠê»´ì•¼ í•œë‹¤."
  },
  {
    section:"ê²°ë¡  â€” ìµœì¢… í†µì°°",
    q:"ì±…ì„ê°ì€ ì‹œê°„ì„ ìƒëŠ” ê²ƒì´ ì•„ë‹ˆë¼ â€” ê²°ë¡  ë§ˆë¬´ë¦¬ ë‘ ë¬¸ì¥ì€?",
    prompt:"Responsibility is not measured in grand ã€___ã€‘. It is built in the small moments when no one is watching, when the cost is real, and when we choose ã€___ã€‘ over convenience regardless.\nIn the end, Responsibility is not about losing ã€___ã€‘. It is about shaping the person who must stand in that ã€___ã€‘.",
    blanks:["gestures","integrity","time","time"],
    answer:"gestures / integrity / time / time",
    full:"Responsibility is not measured in grand gestures. It is built in the small moments when no one is watching, when the cost is real, and when we choose integrity over convenience regardless. In the end, Responsibility is not about losing time. It is about shaping the person who must stand in that time.",
    hint:"ì œìŠ¤ì²˜ / ë¬´ê²°ì„±(integrity) / time / time",
    tip:"'shaping the person who must stand in that time' â€” ì—ì„¸ì´ ì „ì²´ë¥¼ ë§ˆë¬´ë¦¬ì§“ëŠ” ê°€ì¥ ê°•í•œ ë¬¸ì¥."
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE & SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S = {
  task:null, deck:[], queue:[], cursor:0,
  cfg: JSON.parse(localStorage.getItem('s2cfg')||'{"order":"seq","retry":"on"}'),
  bm: JSON.parse(localStorage.getItem('s2bm')||'{}'),
  wrong:[], ok:0, ng:0, answered:false
};

document.getElementById('cntA').textContent = DECK_A.length + ' ë¬¸í•­';
document.getElementById('cntB').textContent = DECK_B.length + ' ë¬¸í•­';

// restore settings UI
document.querySelectorAll('#og .tbtn').forEach(b => b.classList.toggle('on', b.dataset.v === S.cfg.order));
document.querySelectorAll('#rg .tbtn').forEach(b => {
  b.classList.toggle('on', b.dataset.v === S.cfg.retry);
  if(b.dataset.v==='on') b.classList.toggle('gold', S.cfg.retry==='on');
});

function setSetting(k, v, btn) {
  S.cfg[k] = v;
  btn.parentElement.querySelectorAll('.tbtn').forEach(b => b.classList.remove('on','gold'));
  btn.classList.add('on');
  if(k==='retry' && v==='on') btn.classList.add('gold');
  localStorage.setItem('s2cfg', JSON.stringify(S.cfg));
}

function shuffle(a) {
  const r=[...a];
  for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]];}
  return r;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TASK START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTask(task, retryDeck) {
  S.task = task;
  S.deck = retryDeck || (task==='A' ? DECK_A : DECK_B);
  S.wrong=[]; S.ok=0; S.ng=0; S.answered=false;
  let idx = S.deck.map((_,i)=>i);
  if(S.cfg.order==='rev') idx.reverse();
  else if(S.cfg.order==='rnd') idx = shuffle(idx);
  S.queue=idx; S.cursor=0;
  showScreen('quizScreen');
  loadCard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CARD LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadCard() {
  const idx = S.queue[S.cursor];
  const card = S.deck[idx];
  S.answered = false;

  document.getElementById('pCur').textContent = S.cursor+1;
  document.getElementById('pTot').textContent = S.queue.length;
  document.getElementById('pBar').style.width = (S.cursor/S.queue.length*100)+'%';
  const ol = {seq:'ìˆœì„œ',rev:'ì—­ìˆœ',rnd:'ëœë¤'};
  document.getElementById('mBadge').textContent = 'Task '+S.task+' Â· '+ol[S.cfg.order];

  // type badge
  const tb = document.getElementById('cTypeBadge');
  tb.className = 'ctype '+(S.task==='A'?'ct-a':'ct-b');
  tb.textContent = S.task==='A' ? 'Template Slot' : 'Keyword Cloze';

  document.getElementById('cSec').textContent = card.section;

  // bookmark
  const bk = S.bm[S.task+'-'+idx];
  const bb = document.getElementById('bmkBtn');
  bb.textContent = bk?'â˜…':'â˜†'; bb.classList.toggle('on',!!bk);

  // question
  document.getElementById('cQ').textContent = card.q;

  // prompt rendering
  document.getElementById('cPrompt').innerHTML = renderPrompt(card.prompt, S.task);

  // tip box
  const tb2 = document.getElementById('tipBox');
  if(card.tip){ tb2.style.display='block'; tb2.textContent='ğŸ’¡ '+card.tip; }
  else { tb2.style.display='none'; }

  // reset
  hideTtsBar();
  document.getElementById('hintTxt').className='hint-txt';
  const fb = document.getElementById('fb');
  fb.className='fb'; fb.style.display='none';
  const inp = document.getElementById('aInp');
  inp.value=''; inp.className='ainput'; inp.disabled=false;
  document.getElementById('aBtns').style.display='grid';
  document.getElementById('nBtns').style.display='none';

  // re-animate
  const c = document.getElementById('qCard');
  c.style.animation='none'; c.offsetHeight; c.style.animation='';
  inp.focus();
}

function renderPrompt(text, task) {
  const blankCls = task==='A' ? 'red-blank' : 'kw-blank';
  // replace ã€___ã€‘ with blank span
  let html = text.replace(/ã€___ã€‘/g, `<span class="${blankCls}">?</span>`);
  // highlight ğŸ”´[...] slots in task A
  html = html.replace(/ğŸ”´\[([^\]]+)\]/g, '<span style="color:#e06c75;font-family:\'DM Mono\',monospace;font-size:13px;opacity:.8">[$1]</span>');
  // newlines
  html = html.replace(/\n/g, '<br>');
  return html;
}

function renderFilled(text, blanks, correct, task) {
  const cls = correct ? 'filled' : 'wrong';
  const blankBase = task==='A' ? 'red-blank' : 'kw-blank';
  let i=0;
  let html = text.replace(/ã€___ã€‘/g, ()=>`<span class="${blankBase} ${cls}">${blanks[i++]||'?'}</span>`);
  html = html.replace(/ğŸ”´\[([^\]]+)\]/g, '<span style="color:#e06c75;font-family:\'DM Mono\',monospace;font-size:13px;opacity:.8">[$1]</span>');
  html = html.replace(/\n/g,'<br>');
  return html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ANSWER CHECK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkAns() {
  if(S.answered) return;
  const idx = S.queue[S.cursor];
  const card = S.deck[idx];
  const val = document.getElementById('aInp').value.trim();
  if(!val){ reveal(card, false, true); return; }
  const norm = s => s.toLowerCase().replace(/['''""`\-]/g,'').replace(/\s+/g,' ').trim();
  const ok = card.blanks.every(b => norm(val).includes(norm(b)));
  reveal(card, ok, false);
}

function reveal(card, ok, skipped) {
  S.answered = true;
  const idx = S.queue[S.cursor];
  if(!skipped){
    if(ok) S.ok++;
    else { S.ng++; if(S.cfg.retry==='on') S.wrong.push(idx); }
  } else { S.ng++; S.wrong.push(idx); }

  const inp = document.getElementById('aInp');
  inp.disabled=true;
  if(!skipped) inp.className='ainput '+(ok?'ok':'ng');

  // re-render prompt with filled blanks
  if(!skipped) {
    document.getElementById('cPrompt').innerHTML =
      renderFilled(card.prompt, card.blanks, ok, S.task);
  }

  // feedback
  let hl = card.full;
  card.blanks.forEach(b=>{
    hl = hl.replace(new RegExp('('+b.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')+')','gi'),
      '<span class="hl">$1</span>');
  });
  document.getElementById('fbLbl').textContent = skipped ? 'ê±´ë„ˆëœ€' : ok ? 'âœ“ ì •ë‹µ!' : 'âœ— ì˜¤ë‹µ';
  document.getElementById('fbTxt').innerHTML = hl;
  const fb = document.getElementById('fb');
  fb.className = 'fb show '+(ok&&!skipped?'ok-fb':'ng-fb');
  fb.style.display='block';

  document.getElementById('aBtns').style.display='none';
  document.getElementById('nBtns').style.display='grid';

  // TTS: read full sentence aloud
  showTtsBar(hl);
}

function showHint() {
  const card = S.deck[S.queue[S.cursor]];
  const h = document.getElementById('hintTxt');
  h.textContent = 'ğŸ’¡ ' + card.hint;
  h.className = 'hint-txt show';
}

function skipCard() { reveal(S.deck[S.queue[S.cursor]], false, true); }

function handleKey(e) {
  if(e.key==='Enter'&&!e.shiftKey){
    e.preventDefault();
    if(S.answered) nextCard(); else checkAns();
  }
}

function nextCard() {
  S.cursor++;
  if(S.cursor>=S.queue.length) showResult(); else loadCard();
}

function toggleBmk() {
  const idx = S.queue[S.cursor];
  const k = S.task+'-'+idx;
  S.bm[k]=!S.bm[k];
  localStorage.setItem('s2bm',JSON.stringify(S.bm));
  const bb=document.getElementById('bmkBtn');
  bb.textContent=S.bm[k]?'â˜…':'â˜†'; bb.classList.toggle('on',!!S.bm[k]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESULT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showResult() {
  const total=S.queue.length;
  const rate=total>0?Math.round(S.ok/total*100):0;
  document.getElementById('rEmoji').textContent = rate>=90?'ğŸ†':rate>=70?'ğŸ¯':rate>=50?'ğŸ“š':'ğŸ’ª';
  document.getElementById('rTitle').textContent = rate>=90?'ì™„ë²½!':rate>=70?'ì˜í–ˆì–´ìš”!':rate>=50?'ê³„ì† ë„ì „!':'ë‹¤ì‹œ ë„ì „!';
  document.getElementById('rSub').textContent = 'Task '+S.task+' Â· '+{seq:'ìˆœì„œ',rev:'ì—­ìˆœ',rnd:'ëœë¤'}[S.cfg.order]+' ëª¨ë“œ';
  document.getElementById('sOk').textContent=S.ok;
  document.getElementById('sNg').textContent=S.ng;
  document.getElementById('sRate').textContent=rate+'%';
  const wl=document.getElementById('wList'), rb=document.getElementById('retryWBtn');
  if(S.wrong.length>0){
    wl.style.display='block'; rb.style.display='flex';
    document.getElementById('wItems').innerHTML=S.wrong.map(i=>{
      const c=S.deck[i];
      return `<div class="wi"><span class="wi-sec">${c.section}</span>${c.q}</div>`;
    }).join('');
  } else { wl.style.display='none'; rb.style.display='none'; }
  showScreen('resultScreen');
}

function retryWrong(){ startTask(S.task, S.wrong.map(i=>S.deck[i])); }
function retryAll(){ startTask(S.task, null); }
function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function goHome(){ ttsStop(); showScreen('homeScreen'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TTS ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TTS = {
  rate: 1,
  utt: null,
  playing: false,
  text: '',
  supported: 'speechSynthesis' in window
};

function ttsInit() {
  // preload voices (some browsers need this)
  if(TTS.supported) speechSynthesis.getVoices();
}
window.addEventListener('load', ttsInit);
window.speechSynthesis && window.addEventListener('beforeunload', ()=> speechSynthesis.cancel());

function ttsSpeak(text) {
  if(!TTS.supported) return;
  speechSynthesis.cancel();
  TTS.text = text;
  TTS.playing = true;
  updateTtsUI(true);

  const utt = new SpeechSynthesisUtterance(text);
  utt.lang = 'en-GB';
  utt.rate = TTS.rate;
  utt.pitch = 1;

  // prefer a natural English voice
  const voices = speechSynthesis.getVoices();
  const preferred = voices.find(v=>
    v.lang.startsWith('en') && (v.name.includes('Daniel') || v.name.includes('Karen') ||
    v.name.includes('Samantha') || v.name.includes('Google UK') || v.name.includes('Arthur'))
  ) || voices.find(v=> v.lang.startsWith('en-GB'))
    || voices.find(v=> v.lang.startsWith('en'));
  if(preferred) utt.voice = preferred;

  utt.onend = () => { TTS.playing=false; updateTtsUI(false); };
  utt.onerror = () => { TTS.playing=false; updateTtsUI(false); };
  TTS.utt = utt;
  speechSynthesis.speak(utt);
}

function ttsStop() {
  if(!TTS.supported) return;
  speechSynthesis.cancel();
  TTS.playing = false;
  updateTtsUI(false);
}

function ttsToggle() {
  if(TTS.playing) { ttsStop(); return; }
  ttsSpeak(TTS.text);
}

function setTtsRate(r, btn) {
  TTS.rate = r;
  document.querySelectorAll('.tts-speed button').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  // if currently playing, restart at new rate
  if(TTS.playing) ttsSpeak(TTS.text);
}

function updateTtsUI(playing) {
  const btn = document.getElementById('ttsPlayBtn');
  const lbl = document.getElementById('ttsLabel');
  if(!btn) return;
  btn.textContent = playing ? 'â– ' : 'â–¶';
  btn.classList.toggle('playing', playing);
  lbl.textContent = playing ? 'ì¬ìƒ ì¤‘... (í´ë¦­í•˜ì—¬ ì •ì§€)' : 'ì •ë‹µ ë¬¸ì¥ ë“£ê¸°';
}

function showTtsBar(fullText) {
  // strip HTML tags for speech
  const clean = fullText.replace(/<[^>]+>/g,'').replace(/\[.*?\]/g,'').trim();
  TTS.text = clean;
  TTS.playing = false;
  updateTtsUI(false);
  const bar = document.getElementById('ttsBar');
  bar.style.display = 'flex';
  // auto-play after short delay
  setTimeout(()=> ttsSpeak(clean), 400);
}

function hideTtsBar() {
  ttsStop();
  const bar = document.getElementById('ttsBar');
  if(bar) bar.style.display = 'none';
}
</script>
</body>
</html>
