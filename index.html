<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë§í•´ë³´ì¹´ S2 í€´ì¦ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=DM+Mono:wght@400;500&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c28;
    --border: #2a2a3d;
    --accent: #c8a96e;
    --accent2: #7c6fcd;
    --text: #e8e8f0;
    --text-muted: #7070a0;
    --correct: #5cb88a;
    --wrong: #e06c75;
    --radius: 16px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 60% 50% at 20% 10%, rgba(124,111,205,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 80% 90%, rgba(200,169,110,0.10) 0%, transparent 60%);
    pointer-events: none; z-index: 0;
  }
  .app {
    position: relative; z-index: 1;
    width: 100%; max-width: 680px;
    padding: 24px 16px;
    min-height: 100vh;
    display: flex; flex-direction: column;
  }
  .screen { display: none; flex-direction: column; gap: 20px; flex: 1; }
  .screen.active { display: flex; }
  .home-header { text-align: center; padding: 40px 0 20px; }
  .home-header .eyebrow {
    font-family: 'DM Mono', monospace;
    font-size: 11px; letter-spacing: 0.25em;
    color: var(--text-muted); text-transform: uppercase; margin-bottom: 12px;
  }
  .home-header h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(32px, 8vw, 52px); line-height: 1.1;
  }
  .home-header h1 em { font-style: italic; color: var(--accent); }
  .home-header p { margin-top: 12px; font-size: 14px; color: var(--text-muted); line-height: 1.6; }
  .task-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .task-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 28px 20px;
    cursor: pointer; transition: all 0.25s ease; position: relative; overflow: hidden;
  }
  .task-card::before { content: ''; position: absolute; inset: 0; opacity: 0; transition: opacity 0.3s; }
  .task-card.a::before { background: linear-gradient(135deg, rgba(124,111,205,0.15), transparent); }
  .task-card.b::before { background: linear-gradient(135deg, rgba(200,169,110,0.15), transparent); }
  .task-card:hover { transform: translateY(-3px); border-color: var(--text-muted); }
  .task-card:hover::before { opacity: 1; }
  .task-card .tag {
    font-family: 'DM Mono', monospace; font-size: 10px;
    letter-spacing: 0.2em; text-transform: uppercase;
    padding: 4px 8px; border-radius: 4px; display: inline-block; margin-bottom: 14px;
  }
  .task-card.a .tag { background: rgba(124,111,205,0.2); color: var(--accent2); }
  .task-card.b .tag { background: rgba(200,169,110,0.2); color: var(--accent); }
  .task-card h2 { font-family: 'Playfair Display', serif; font-size: 18px; line-height: 1.3; margin-bottom: 6px; }
  .task-card p { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
  .task-card .count { margin-top: 16px; font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-muted); }
  .settings-panel {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 20px;
  }
  .settings-panel h3 {
    font-size: 12px; font-family: 'DM Mono', monospace;
    letter-spacing: 0.15em; text-transform: uppercase;
    color: var(--text-muted); margin-bottom: 16px;
  }
  .setting-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 0; border-bottom: 1px solid var(--border); gap: 12px;
  }
  .setting-row:last-child { border-bottom: none; }
  .setting-label { font-size: 13px; color: var(--text); }
  .setting-sublabel { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
  .toggle-group {
    display: flex; background: var(--bg);
    border: 1px solid var(--border); border-radius: 8px; overflow: hidden; flex-shrink: 0;
  }
  .toggle-btn {
    padding: 6px 12px; font-size: 12px; font-family: 'DM Mono', monospace;
    border: none; background: transparent; color: var(--text-muted); cursor: pointer; transition: all 0.2s;
  }
  .toggle-btn.active { background: var(--accent2); color: #fff; }
  .toggle-btn.active.gold { background: var(--accent); color: var(--bg); }
  .quiz-header { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; }
  .back-btn {
    background: none; border: none; color: var(--text-muted);
    cursor: pointer; font-size: 20px; padding: 4px 8px; border-radius: 8px; transition: color 0.2s;
  }
  .back-btn:hover { color: var(--text); }
  .progress-info { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--text-muted); text-align: center; }
  .progress-info .current { color: var(--text); font-size: 16px; font-weight: 500; }
  .mode-badge {
    font-family: 'DM Mono', monospace; font-size: 10px;
    padding: 4px 8px; border-radius: 6px; background: var(--surface2); color: var(--text-muted); letter-spacing: 0.1em;
  }
  .progress-bar-wrap { height: 3px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    border-radius: 2px; transition: width 0.4s ease;
  }
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 20px; padding: 32px 28px;
    flex: 1; min-height: 240px;
    display: flex; flex-direction: column; gap: 16px;
    position: relative; overflow: hidden;
    animation: cardIn 0.35s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes cardIn {
    from { opacity: 0; transform: translateY(20px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }
  .card::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent2), transparent); opacity: 0.5;
  }
  .card-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .card-type-badge {
    font-family: 'DM Mono', monospace; font-size: 10px;
    padding: 3px 8px; border-radius: 4px; letter-spacing: 0.1em; text-transform: uppercase;
  }
  .badge-cloze { background: rgba(124,111,205,0.2); color: var(--accent2); }
  .badge-structure { background: rgba(200,169,110,0.2); color: var(--accent); }
  .badge-paraphrase { background: rgba(92,184,138,0.2); color: var(--correct); }
  .card-section { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-muted); letter-spacing: 0.1em; }
  .card-question { font-size: 15px; line-height: 1.9; color: var(--text); flex: 1; }
  .blank {
    display: inline-block; background: var(--surface2);
    border: 1.5px solid var(--accent2); border-radius: 6px;
    padding: 0 8px; min-width: 80px; color: var(--accent2);
    font-style: italic; font-family: 'DM Mono', monospace; font-size: 13px; transition: all 0.3s;
  }
  .blank.revealed { background: rgba(92,184,138,0.15); border-color: var(--correct); color: var(--correct); }
  .blank.wrong-reveal { background: rgba(224,108,117,0.15); border-color: var(--wrong); color: var(--wrong); }
  .input-area { display: flex; flex-direction: column; gap: 10px; }
  .answer-input {
    width: 100%; background: var(--surface2); border: 1.5px solid var(--border);
    border-radius: 10px; padding: 12px 16px; color: var(--text);
    font-family: 'Noto Sans KR', sans-serif; font-size: 14px; outline: none;
    transition: border-color 0.2s; resize: none;
  }
  .answer-input:focus { border-color: var(--accent2); }
  .answer-input.correct { border-color: var(--correct); background: rgba(92,184,138,0.08); }
  .answer-input.incorrect { border-color: var(--wrong); background: rgba(224,108,117,0.08); }
  .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .btn {
    padding: 12px 16px; border-radius: 10px; font-size: 13px;
    font-family: 'Noto Sans KR', sans-serif; font-weight: 500;
    border: none; cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 6px;
  }
  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--accent2); color: #fff; grid-column: 1 / -1; }
  .btn-primary:hover { filter: brightness(1.15); }
  .btn-secondary { background: var(--surface2); border: 1px solid var(--border); color: var(--text-muted); }
  .btn-secondary:hover { border-color: var(--text-muted); color: var(--text); }
  .btn-gold { background: var(--accent); color: var(--bg); font-weight: 700; grid-column: 1 / -1; }
  .btn-gold:hover { filter: brightness(1.1); }
  .feedback {
    border-radius: 10px; padding: 14px 16px; font-size: 13px; line-height: 1.7;
    display: none; animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
  .feedback.show { display: block; }
  .feedback.correct-fb { background: rgba(92,184,138,0.1); border: 1px solid rgba(92,184,138,0.3); }
  .feedback.wrong-fb { background: rgba(224,108,117,0.1); border: 1px solid rgba(224,108,117,0.3); }
  .feedback .answer-label {
    font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-muted);
    text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 6px;
  }
  .feedback .answer-text { color: var(--text); font-size: 14px; line-height: 1.7; }
  .highlight { color: var(--accent); font-weight: 700; }
  .hint-text {
    font-family: 'DM Mono', monospace; font-size: 12px; color: var(--accent);
    padding: 8px 12px; background: rgba(200,169,110,0.08);
    border-radius: 8px; border: 1px solid rgba(200,169,110,0.2); display: none;
  }
  .hint-text.show { display: block; }
  .bookmark-btn {
    background: none; border: none; font-size: 18px; cursor: pointer;
    padding: 4px; color: var(--text-muted); transition: all 0.2s; line-height: 1;
  }
  .bookmark-btn.active { color: var(--accent); }
  .bookmark-btn:hover { transform: scale(1.2); }
  .result-screen { text-align: center; padding: 20px 0; display: flex; flex-direction: column; gap: 20px; flex: 1; }
  .result-header h2 { font-family: 'Playfair Display', serif; font-size: 36px; margin-bottom: 8px; }
  .result-header p { color: var(--text-muted); font-size: 14px; }
  .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 12px; }
  .stat-card .val { font-family: 'Playfair Display', serif; font-size: 32px; color: var(--accent); display: block; }
  .stat-card .lbl { font-size: 11px; color: var(--text-muted); font-family: 'DM Mono', monospace; margin-top: 4px; }
  .wrong-list {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 16px; text-align: left; max-height: 200px; overflow-y: auto;
  }
  .wrong-list h4 {
    font-size: 11px; font-family: 'DM Mono', monospace; color: var(--text-muted);
    text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 12px;
  }
  .wrong-item { font-size: 12px; color: var(--text-muted); padding: 8px 0; border-bottom: 1px solid var(--border); line-height: 1.5; }
  .wrong-item:last-child { border-bottom: none; }
  .wrong-item .wi-section { color: var(--wrong); font-family: 'DM Mono', monospace; font-size: 10px; }
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  @media (max-width: 480px) {
    .task-cards { grid-template-columns: 1fr; }
    .card { padding: 24px 18px; }
  }
</style>
</head>
<body>
<div class="app">

  <!-- HOME -->
  <div class="screen active" id="homeScreen">
    <div class="home-header">
      <div class="eyebrow">ë§í•´ë³´ì¹´ Â· S2 ì¸ì¶œí›ˆë ¨</div>
      <h1>Structure<br><em>Recall</em></h1>
      <p>ì„œë¡ /ë³¸ë¡ /ê²°ë¡  êµ¬ì¡°ë¥¼ ëª¸ìœ¼ë¡œ ìµíˆëŠ” ë¹ˆì¹¸ ì¸ì¶œ í›ˆë ¨</p>
    </div>
    <div class="task-cards">
      <div class="task-card a" onclick="startTask('A')">
        <div class="tag">Task A</div>
        <h2>Space Exploration</h2>
        <p>ì‚¬íšŒì  ë¶ˆí‰ë“±ê³¼ ìš°ì£¼íƒì‚¬, ë¡¤ìŠ¤ì˜ ì •ì˜ë¡ ê¹Œì§€</p>
        <div class="count" id="countA">â€” ë¬¸í•­</div>
      </div>
      <div class="task-card b" onclick="startTask('B')">
        <div class="tag">Task B</div>
        <h2>Responsibility</h2>
        <p>ìƒˆë²½ 2ì‹œ ì„œë²„ì¥ì• ì—ì„œ ë°°ìš°ëŠ” ì±…ì„ê°ì˜ ë³¸ì§ˆ</p>
        <div class="count" id="countB">â€” ë¬¸í•­</div>
      </div>
    </div>
    <div class="settings-panel">
      <h3>âš™ ì¶œì œ ì„¤ì •</h3>
      <div class="setting-row">
        <div>
          <div class="setting-label">ì¶œì œ ìˆœì„œ</div>
          <div class="setting-sublabel">ì¹´ë“œê°€ ë‚˜ì˜¤ëŠ” ìˆœì„œ</div>
        </div>
        <div class="toggle-group" id="orderToggle">
          <button class="toggle-btn active" data-val="sequential" onclick="setSetting('order','sequential',this)">ìˆœì„œ</button>
          <button class="toggle-btn" data-val="reverse" onclick="setSetting('order','reverse',this)">ì—­ìˆœ</button>
          <button class="toggle-btn" data-val="random" onclick="setSetting('order','random',this)">ëœë¤</button>
        </div>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">ì¶œì œ ë°©í–¥</div>
          <div class="setting-sublabel">ë¹ˆì¹¸â†’ì •ë‹µ or ì •ë‹µâ†’ë¬¸ì¥</div>
        </div>
        <div class="toggle-group" id="dirToggle">
          <button class="toggle-btn active" data-val="forward" onclick="setSetting('direction','forward',this)">ì •ë°©í–¥</button>
          <button class="toggle-btn" data-val="backward" onclick="setSetting('direction','backward',this)">ì—­ë°©í–¥</button>
        </div>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">ì˜¤ë‹µë§Œ ì¬ì¶œì œ</div>
          <div class="setting-sublabel">í‹€ë¦° ì¹´ë“œ ìë™ ì¬ì‹œë„</div>
        </div>
        <div class="toggle-group" id="retryToggle">
          <button class="toggle-btn active gold" data-val="on" onclick="setSetting('retry','on',this)">ON</button>
          <button class="toggle-btn" data-val="off" onclick="setSetting('retry','off',this)">OFF</button>
        </div>
      </div>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="screen" id="quizScreen">
    <div class="quiz-header">
      <button class="back-btn" onclick="goHome()">â†</button>
      <div class="progress-info">
        <span class="current" id="progressCurrent">1</span>
        <span> / </span>
        <span id="progressTotal">10</span>
      </div>
      <span class="mode-badge" id="modeBadge">ìˆœì„œ</span>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
    </div>
    <div class="card" id="quizCard">
      <div class="card-meta">
        <span class="card-type-badge badge-cloze" id="cardTypeBadge">Keyword Cloze</span>
        <span class="card-section" id="cardSection">[ì„œë¡ -Hook]</span>
        <button class="bookmark-btn" id="bookmarkBtn" onclick="toggleBookmark()">â˜†</button>
      </div>
      <div class="card-question" id="cardQuestion">Loading...</div>
      <div class="hint-text" id="hintText"></div>
      <div class="feedback" id="feedback">
        <div class="answer-label"></div>
        <div class="answer-text" id="feedbackText"></div>
      </div>
    </div>
    <div class="input-area" id="inputArea">
      <textarea class="answer-input" id="answerInput" rows="2" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”... (Enterë¡œ ì œì¶œ)" onkeydown="handleKey(event)"></textarea>
      <div class="btn-row" id="actionBtns">
        <button class="btn btn-primary" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
        <button class="btn btn-secondary" onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
        <button class="btn btn-secondary" onclick="skipCard()">ê±´ë„ˆë›°ê¸° â†’</button>
      </div>
      <div class="btn-row" id="nextBtns" style="display:none">
        <button class="btn btn-gold" onclick="nextCard()">ë‹¤ìŒ ì¹´ë“œ â†’</button>
      </div>
    </div>
  </div>

  <!-- RESULT -->
  <div class="screen" id="resultScreen">
    <div class="result-screen">
      <div class="result-header">
        <h2 id="resultEmoji">ğŸ¯</h2>
        <h2 id="resultTitle">ì™„ë£Œ!</h2>
        <p id="resultSub">Task A Â· ìˆœì„œ ëª¨ë“œ</p>
      </div>
      <div class="stat-grid">
        <div class="stat-card">
          <span class="val" id="statCorrect">0</span>
          <div class="lbl">ì •ë‹µ</div>
        </div>
        <div class="stat-card">
          <span class="val" id="statWrong">0</span>
          <div class="lbl">ì˜¤ë‹µ</div>
        </div>
        <div class="stat-card">
          <span class="val" id="statRate">0%</span>
          <div class="lbl">ì •í™•ë„</div>
        </div>
      </div>
      <div class="wrong-list" id="wrongList" style="display:none">
        <h4>ì˜¤ë‹µ ëª©ë¡</h4>
        <div id="wrongItems"></div>
      </div>
      <div style="display:flex; flex-direction:column; gap:10px;">
        <button class="btn btn-gold" id="retryWrongBtn" onclick="retryWrong()" style="display:none">ì˜¤ë‹µë§Œ ë‹¤ì‹œ í’€ê¸°</button>
        <button class="btn btn-primary" onclick="retryAll()">ì „ì²´ ë‹¤ì‹œ í’€ê¸°</button>
        <button class="btn btn-secondary" onclick="goHome()">ë©”ì¸ìœ¼ë¡œ</button>
      </div>
    </div>
  </div>
</div>

<script>
const TASK_A = [
  { section:"[ì„œë¡ -ë„ì…]", type:"cloze", question:"ì£¼ì œë¥¼ ë‹¨ìˆœí•œ ì´ë¶„ë²•ìœ¼ë¡œ ë³´ì§€ ì•Šê³  ë³µì¡í•˜ê²Œ ì–½í˜€ ìˆë‹¤ê³  ì ‘ê·¼í•˜ëŠ” ë§ŒëŠ¥ ì˜¤í”„ë‹ì€?", prompt:"The question of [Space Exploration] is often framed as a simple [[___]], yet reality suggests a far more intricate [[___]].", blanks:["dichotomy","tapestry"], answer:"dichotomy / tapestry", fullSentence:"The question of Space Exploration is often framed as a simple dichotomy (Scientific Progress vs. Waste of Resources), yet reality suggests a far more intricate tapestry.", hint:"ì´ë¶„ë²• / ë³µì¡í•œ ì§ë¬¼" },
  { section:"[ì„œë¡ -ë°°ê²½]", type:"cloze", question:"ì´ ë…¼ìŸì´ ì§„ê³µ ìƒíƒœê°€ ì•„ë‹ˆë¼ ì‚¬íšŒì •ì¹˜ì  ë§¥ë½ ì†ì— ìˆìŒì„ ì§šì–´ì£¼ëŠ” ë¬¸ì¥ì€?", prompt:"This debate is not occurring in [[___]]; it is deeply [[___]] in the socio-political context of extreme global poverty and climate crisis.", blanks:["a vacuum","embedded"], answer:"a vacuum / embedded", fullSentence:"This debate is not occurring in a vacuum; it is deeply embedded in the socio-political context of extreme global poverty and climate crisis.", hint:"ì§„ê³µ / ê¹Šì´ ë‚´ì¬ëœ" },
  { section:"[ì„œë¡ -ì£¼ì¥]", type:"cloze", question:"ì´ ì£¼ì œê°€ ì–‘ë‚ ì˜ ê²€ìœ¼ë¡œ ì‘ìš©í•œë‹¤ëŠ” ë©”ì¸ ì£¼ì¥ ë¬¸ì¥ì—ì„œ ë¹ˆì¹¸ì„ ì±„ìš°ì„¸ìš”.", prompt:"Strict adherence to unbridled interstellar ambition acts as a [[___]], offering technological hope while simultaneously threatening [[___]].", blanks:["double-edged sword","ethical negligence"], answer:"double-edged sword / ethical negligence", fullSentence:"Strict adherence to unbridled interstellar ambition acts as a double-edged sword, offering technological hope while simultaneously threatening ethical negligence.", hint:"ì–‘ë‚ ì˜ ê²€ / ìœ¤ë¦¬ì  ë¬´ê´€ì‹¬" },
  { section:"[ë³¸ë¡ 1-ë„ì…]", type:"structure", question:"ì—­ì‚¬ê°€ ì‹¬ë¦¬ì  íŒ¨í„´ì„ ë°˜ë³µí•œë‹¤ëŠ” ë³¸ë¡ 1 ë§ŒëŠ¥ ì‹œì‘ ë¬¸ì¥ â€” í•µì‹¬ ê°œë…ì–´ëŠ”?", prompt:"Central to this understanding is the concept that history often [[___]] its psychological patterns. History provides a [[___]] lesson in the form of the Industrial Revolution.", blanks:["repeats","salutary"], answer:"repeats / salutary", fullSentence:"Central to this understanding is the concept that history often repeats its psychological patterns. History provides a salutary lesson in the form of the Industrial Revolution.", hint:"ë°˜ë³µí•˜ë‹¤ / êµí›ˆì ì¸, ìœ ìµí•œ" },
  { section:"[ë³¸ë¡ 1-ì˜ˆì‹œ]", type:"cloze", question:"ì‚°ì—…í˜ëª… ë‹¹ì‹œ íš¨ìœ¨ì„± ì¶”êµ¬ê°€ ì¸ê°„ì„ 'ê¸°ê³„ì˜ í†±ë‹ˆë°”í€´'ë¡œ ì „ë½ì‹œì¼°ë‹¤ëŠ” ë¬¸ì¥ì˜ í•µì‹¬ í‘œí˜„ì€?", prompt:"The relentless pursuit of efficiency reduced human workers to mere \"[[___]].\" The grim reality was characterized by dehumanizing conditions such as [[___]].", blanks:["cogs in a machine","child labor"], answer:"cogs in a machine / child labor", fullSentence:"The relentless pursuit of efficiency reduced human workers to mere 'cogs in a machine.' The grim reality was characterized by dehumanizing conditions such as child labor.", hint:"ê¸°ê³„ì˜ í†±ë‹ˆë°”í€´ / ì•„ë™ë…¸ë™" },
  { section:"[ë³¸ë¡ 1-ë¶„ì„]", type:"cloze", question:"ê³µì¥ì´ íê¸°ë¬¼ì„ ë§Œë“¤ë“¯ ë¶ˆí‰ë“±í•œ ì‚¬íšŒê°€ 'ì†Œì™¸ëœ ìë“¤'ì„ ë§Œë“ ë‹¤ëŠ” ë¹„ìœ  ë¬¸ì¥ì˜ í•µì‹¬ì€?", prompt:"Just as factories produced [[___]], our unequal society manufactures [[___]].", blanks:["industrial waste","the left-behind"], answer:"industrial waste / the left-behind", fullSentence:"Just as factories produced industrial waste, our unequal society manufactures 'the left-behind'.", hint:"ì‚°ì—… íê¸°ë¬¼ / ë’¤ì²˜ì§„ ìë“¤" },
  { section:"[ë³¸ë¡ 1-ì†Œê²°ë¡ ]", type:"paraphrase", question:"'broken cogs'ì™€ 'broken machine' ë¹„ìœ ë¡œ í”¼ìƒì  í•´ê²°ì±…ì„ ë¹„íŒí•˜ëŠ” ë¬¸ì¥ì˜ í•µì‹¬ ë…¼ë¦¬ëŠ”?", prompt:"By focusing only on Mars colonization, we are merely discarding the [[___]] while ignoring the [[___]] that created them.", blanks:["broken cogs","broken machine"], answer:"broken cogs / broken machine", fullSentence:"By focusing only on Mars colonization, we are merely discarding the 'broken cogs' while ignoring the 'broken machine' that created them.", hint:"ë§ê°€ì§„ í†±ë‹ˆë°”í€´ / ë§ê°€ì§„ ê¸°ê³„" },
  { section:"[ë³¸ë¡ 2-ë°˜ë¡  ìˆ˜ìš©]", type:"cloze", question:"íšŒì˜ë¡ ìë“¤ì˜ ì£¼ì¥ì„ ìˆ˜ìš©í•˜ë©° ì§€ì ìœ¼ë¡œ ì •ì§í•œ íƒœë„ë¥¼ ë³´ì—¬ì£¼ëŠ” í•µì‹¬ ì–´êµ¬ëŠ”?", prompt:"Admittedly, skeptics might argue that space technology ultimately benefits Earth. It would be [[___]] to dismiss innovations like GPS.", blanks:["intellectually dishonest"], answer:"intellectually dishonest", fullSentence:"Admittedly, skeptics might argue that space technology ultimately benefits Earth, and there is some validity to this claim. It would be intellectually dishonest to dismiss innovations like GPS.", hint:"ì§€ì ìœ¼ë¡œ ì •ì§í•˜ì§€ ì•Šì€" },
  { section:"[ë³¸ë¡ 2-ì¡´ ë¡¤ìŠ¤ 1]", type:"structure", question:"ë°˜ë¡ ì„ ë’¤ì§‘ìœ¼ë©° ë¡¤ìŠ¤ì˜ 'ë¬´ì§€ì˜ ë² ì¼'ì„ ëŒì–´ì˜¤ëŠ” ë‘ í•µì‹¬ ê°œë…ì€?", prompt:"This argument ignores '[[___]]'. John Rawls' '[[___]]' demands that we design rules without knowing our own status.", blanks:["the arbitrariness of fortune","Veil of Ignorance"], answer:"the arbitrariness of fortune / Veil of Ignorance", fullSentence:"This argument ignores 'the arbitrariness of fortune'. John Rawls' 'Veil of Ignorance' demands that we design rules without knowing our own status.", hint:"ìš´ì˜ ìì˜ì„± / ë¬´ì§€ì˜ ë² ì¼" },
  { section:"[ë³¸ë¡ 2-ì¡´ ë¡¤ìŠ¤ 2]", type:"cloze", question:"í•©ë¦¬ì  í–‰ìœ„ìë¼ë©´ ìµœì†Œ ìˆ˜í˜œìì—ê²Œ í˜œíƒì´ ì—†ëŠ” êµ¬ì¡°ë¥¼ ì§€ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë¬¸ì¥ì˜ í•µì‹¬ì€?", prompt:"No rational agent would endorse a structure where [[___]], violating the principle that [[___]].", blanks:["survival is a luxury reserved for the wealthy","progress must primarily benefit the least advantaged"], answer:"survival is a luxury / least advantaged", fullSentence:"No rational agent would endorse a structure where survival is a luxury reserved for the wealthy, violating the principle that progress must primarily benefit the least advantaged.", hint:"ìƒì¡´ì´ ë¶€ìœ ì¸µì˜ ì‚¬ì¹˜ / ìµœì†Œ ìˆ˜í˜œìì—ê²Œ ì´ìµ" },
  { section:"[ë³¸ë¡ 2-ì†Œê²°ë¡ ]", type:"structure", question:"ì§„ì •í•œ ì •ì˜ëŠ” 'ìœ¤ë¦¬ì  ìˆœì„œ(ethical sequencing)'ì˜ ë¬¸ì œë¼ëŠ” í•µì‹¬ ë¬¸ì¥ì€?", prompt:"True justice is not about abandoning science, but about [[___]]. Progress in the stars must be tethered to [[___]].", blanks:["ethical sequencing","equity on the soil"], answer:"ethical sequencing / equity on the soil", fullSentence:"True justice is not about abandoning science, but about ethical sequencing. It is about fixing the 'lottery' so that progress in the stars is tethered to equity on the soil.", hint:"ìœ¤ë¦¬ì  ìˆœì„œ / ì§€êµ¬ì˜ í˜•í‰ì„±" },
  { section:"[ë³¸ë¡ 2-í€ì¹˜ë¼ì¸]", type:"paraphrase", question:"ì§€êµ¬ë¥¼ ë°©ì¹˜í•˜ë©° í™”ì„±ì„ ìš°ì„ ì‹œí•˜ëŠ” ê²ƒì€ ë¹„ì „ì´ ì•„ë‹ˆë¼ ë¬´ì—‡ì´ë¼ê³  ë¹„íŒí•˜ëŠ”ê°€?", prompt:"Prioritizing the colonization of Mars while Earth burns is not 'visionary'; it is a [[___]].", blanks:["profound moral abdication"], answer:"profound moral abdication", fullSentence:"Prioritizing the colonization of Mars while Earth burns is not 'visionary'; it is a profound moral abdication.", hint:"ì‹¬ê°í•œ ë„ë•ì  ì§ë¬´ìœ ê¸°" },
  { section:"[ê²°ë¡ -ìš”ì•½]", type:"structure", question:"í•˜ëŠ˜ì„ ìš°ëŸ¬ëŸ¬ë³´ëŠ” ê²ƒì´ ê³ í†µë°›ëŠ” ìë¥¼ ë‚´ë ¤ë³´ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ì§€ ì•ŠëŠ” ì‚¬íšŒë¥¼ ë§Œë“¤ì â€” í•µì‹¬ ëŒ€ë¹„ëŠ”?", prompt:"We must strive to create a society where [[___]] does not imply [[___]].", blanks:["looking up at the heavens","looking down on the suffering"], answer:"looking up at the heavens / looking down on the suffering", fullSentence:"We must strive to create a society where looking up at the heavens does not imply looking down on the suffering.", hint:"í•˜ëŠ˜ì„ ìš°ëŸ¬ëŸ¬ë³´ëŠ” ê²ƒ / ê³ í†µë°›ëŠ” ìë¥¼ ë‚´ë ¤ë³´ëŠ” ê²ƒ" },
  { section:"[ê²°ë¡ -ìµœì¢… í†µì°°]", type:"paraphrase", question:"ë³„ì— ê°ˆ ìê²©ì´ ìˆëŠ” ë¬¸ëª…ì€ ë¨¼ì € ìê¸° ì§‘(ì§€êµ¬)ë¶€í„° ëŒë´ì•¼ í•œë‹¤ â€” í•µì‹¬ í”„ë ˆì´ë°ì€?", prompt:"The question is not '[[___]]', but [[___]]. A civilization worthy of the stars must first prove it can [[___]].", blanks:["can we reach Mars?","whether we deserve to go","tend to its own home"], answer:"can we reach Mars? / whether we deserve to go / tend to its own home", fullSentence:"The question is not simply 'can we reach Mars?', but whether we deserve to go. A civilization worthy of the stars must first prove it can tend to its own home.", hint:"ê°ˆ ìˆ˜ ìˆë‚˜? â†’ ìê²©ì´ ìˆë‚˜? / ìê¸° ì§‘ì„ ëŒë³´ë‹¤" }
];

const TASK_B = [
  { section:"[ì„œë¡ -Hook]", type:"cloze", question:"ì±…ì„ê°ì— ëŒ€í•œ ë‚˜ì˜ 'ê³¼ê±°ì˜ ì°©ê°'ì€? ì–´ë–»ê²Œ ìƒìƒí–ˆë‚˜?", prompt:"I used to imagine it as something [[___]]â€”an attribute worn proudly by [[___]] adults.", blanks:["noble","competent"], answer:"noble / competent", fullSentence:"I used to imagine it as something nobleâ€”an attribute worn proudly by competent adults.", hint:"ê³ ê·€í•œ / ìœ ëŠ¥í•œ" },
  { section:"[ì„œë¡ -Thesis]", type:"cloze", question:"ì±…ì„ê°ì˜ 'ì§„ì§œ ì†ì„±' 3ê°€ì§€ â€” ë¹ˆì¹¸ì„ ì±„ìš°ì„¸ìš”.", prompt:"Responsibility often arrives [[___]], at [[___]] hours, and rarely feels [[___]] at all.", blanks:["quietly","inconvenient","noble"], answer:"quietly / inconvenient / noble", fullSentence:"Only later did I realise that Responsibility often arrives quietly, at inconvenient hours, and rarely feels noble at all.", hint:"ì¡°ìš©íˆ / ë¶ˆí¸í•œ / ê³ ê·€í•˜ê²Œ" },
  { section:"[ë³¸ë¡ 1-ì‚¬ê±´]", type:"cloze", question:"ìƒˆë²½ 2ì‹œ ì„œë²„ ì¥ì• ê°€ í„°ì¡Œì„ ë•Œ ë‚˜ì˜ 'ì†”ì§í•œ ê°ì •' ë‘ ë‹¨ì–´ëŠ”?", prompt:"I did not feel [[___]]. I felt [[___]]. \"Why must I sacrifice my future for a machine?\"", blanks:["admirable","resentful"], answer:"admirable / resentful", fullSentence:"I did not feel admirable. I felt resentful. 'Why must I sacrifice my future for a machine?'", hint:"ì¡´ê²½ìŠ¤ëŸ¬ìš´ / ì›ë§ìŠ¤ëŸ¬ìš´" },
  { section:"[ë³¸ë¡ 1-ê°ˆë“±]", type:"paraphrase", question:"ì•„ë¬´ë„ ëª¨ë¥¼ ê±°ë¼ëŠ” ìœ í˜¹ì„ ë°•ì‚´ ë‚¸ í•œ ë¬¸ì¥ì„ ì™„ì„±í•˜ì„¸ìš”.", prompt:"No one would know that I hesitated. But [[___]].", blanks:["I would know"], answer:"I would know", fullSentence:"No one would know that I hesitated. But I would know.", hint:"ë‚˜ëŠ” ì•Œ ê²ƒì´ë‹¤" },
  { section:"[ë³¸ë¡ 2-ê¹¨ë‹¬ìŒ]", type:"structure", question:"ì±…ì„ê°ì€ ë‚¨ì´ ë³¼ ë•Œê°€ ì•„ë‹ˆë¼ ì–¸ì œì— ê´€í•œ ê²ƒì¸ê°€?", prompt:"Responsibility is rarely about being [[___]]. It is about who we choose to be when we are [[___]].", blanks:["watched","not"], answer:"watched / not (watched)", fullSentence:"Responsibility, I realised, is rarely about being watched. It is about who we choose to be when we are not.", hint:"ì§€ì¼œë³¼ ë•Œ / ì§€ì¼œë³´ì§€ ì•Šì„ ë•Œ" },
  { section:"[ë³¸ë¡ 2-ì§„ì§œ ì¥ì• ë¬¼]", type:"cloze", question:"ì°¨ê°€ìš´ ì„œë²„ì‹¤ì—ì„œ ê¹¨ë‹¬ì€ 'ì§„ì§œ ê·¹ë³µ ëŒ€ìƒ'ì€? (ì„œë²„ê°€ ì•„ë‹ˆë¼...)", prompt:"The server was not the true obstacle. My [[___]] was.", blanks:["bitterness"], answer:"bitterness", fullSentence:"The server was not the true obstacle. My bitterness was.", hint:"ì“´ ë§ˆìŒ, ì›í•œ, ì”ì“¸í•¨" },
  { section:"[ë³¸ë¡ 2-ì¬ì •ì˜]", type:"paraphrase", question:"ì±…ì„ê°ì„ 'ê°€ì¹˜ê´€ê³¼ì˜ ì •ë ¬'ë¡œ ì¬ì •ì˜í•˜ëŠ” ë¬¸ì¥ì€?", prompt:"It is the repeated, often [[___]] choice to act in [[___]] with our values, even when it costs us [[___]].", blanks:["thankless","alignment","comfort"], answer:"thankless / alignment / comfort", fullSentence:"It is the repeated, often thankless choice to act in alignment with our values, even when it costs us comfort.", hint:"ê°ì‚¬ ì—†ëŠ” / ì •ë ¬ / í¸ì•ˆí•¨" },
  { section:"[ê²°ë¡ -ì˜ì‚¬ ì—°ê²°]", type:"structure", question:"ìƒˆë²½ 3ì‹œ ì„œë²„ ì¥ì• ë¥¼ ë¯¸ë˜ì˜ ì˜ì‚¬ ìƒí™œê³¼ ì—°ê²°í•˜ëŠ” ë¸Œë¦¿ì§€ ë¬¸ì¥ì€?", prompt:"Perhaps one day it will not be a [[___]] but a [[___]] who wakes me at [[___]] AM.", blanks:["server","patient","3"], answer:"server / patient / 3", fullSentence:"Perhaps one day it will not be a server but a patient who wakes me at 3 AM.", hint:"ì„œë²„ â†’ í™˜ì / ìƒˆë²½ 3ì‹œ" },
  { section:"[ê²°ë¡ -íƒœë„]", type:"cloze", question:"ë¯¸ë˜ì— í™˜ìê°€ ë‚˜ë¥¼ ê¹¨ìš¸ ë•Œë„ ëŠë‚„ ì†”ì§í•œ ê°ì • ë‘ ê°€ì§€ëŠ”?", prompt:"I suspect I may feel the same flicker of [[___]], the same tired [[___]]. But I hope I will remember that night.", blanks:["resentment","resistance"], answer:"resentment / resistance", fullSentence:"I suspect I may feel the same flicker of resentment, the same tired resistance. But I hope I will remember that night.", hint:"ì›í•œ/ë¶„ë…¸ / ì €í•­ê°" },
  { section:"[ê²°ë¡ -ìµœì¢… í†µì°°]", type:"paraphrase", question:"ì±…ì„ê°ì€ ì‹œê°„ì„ ìƒëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¬´ì—‡ì´ë¼ê³  ê²°ë¡  ì§“ëŠ”ê°€?", prompt:"Responsibility is not about [[___]]. It is about [[___]] the person who stands in that time.", blanks:["losing time","shaping"], answer:"losing time / shaping", fullSentence:"In the end, Responsibility is not about losing time. It is about shaping the person who stands in that time.", hint:"ì‹œê°„ì„ ìƒëŠ” ê²ƒ / ê·¸ ì‹œê°„ì— ì„œ ìˆëŠ” ì‚¬ëŒì„ ë¹šì–´ë‚´ëŠ” ê²ƒ" }
];

let state = {
  task: null, deck: [], queue: [], cursor: 0,
  settings: { order:'sequential', direction:'forward', retry:'on' },
  bookmarks: JSON.parse(localStorage.getItem('bm_s2') || '{}'),
  wrongPool: [], correctCount: 0, wrongCount: 0, answered: false
};

document.getElementById('countA').textContent = TASK_A.length + ' ë¬¸í•­';
document.getElementById('countB').textContent = TASK_B.length + ' ë¬¸í•­';

const saved = JSON.parse(localStorage.getItem('settings_s2') || '{}');
if (saved.order) {
  state.settings = { ...state.settings, ...saved };
  ['orderToggle','dirToggle','retryToggle'].forEach(id => {
    document.getElementById(id).querySelectorAll('.toggle-btn').forEach(b => {
      const key = id === 'orderToggle' ? 'order' : id === 'dirToggle' ? 'direction' : 'retry';
      b.classList.toggle('active', b.dataset.val === state.settings[key]);
      if (id === 'retryToggle' && b.dataset.val === 'on') b.classList.toggle('gold', state.settings.retry === 'on');
    });
  });
}

function setSetting(key, val, btn) {
  state.settings[key] = val;
  btn.parentElement.querySelectorAll('.toggle-btn').forEach(b => {
    b.classList.remove('active', 'gold');
  });
  btn.classList.add('active');
  if (key === 'retry' && val === 'on') btn.classList.add('gold');
  localStorage.setItem('settings_s2', JSON.stringify(state.settings));
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function startTask(task, isRetry, retryDeck) {
  state.task = task;
  state.deck = retryDeck || (task === 'A' ? TASK_A : TASK_B);
  state.wrongPool = []; state.correctCount = 0; state.wrongCount = 0; state.answered = false;
  let indices = state.deck.map((_,i) => i);
  if (state.settings.order === 'reverse') indices.reverse();
  else if (state.settings.order === 'random') indices = shuffle(indices);
  state.queue = indices; state.cursor = 0;
  showScreen('quizScreen');
  loadCard();
}

function loadCard() {
  const idx = state.queue[state.cursor];
  const card = state.deck[idx];
  state.answered = false;
  document.getElementById('progressCurrent').textContent = state.cursor + 1;
  document.getElementById('progressTotal').textContent = state.queue.length;
  document.getElementById('progressBar').style.width = (state.cursor / state.queue.length * 100) + '%';
  const modeMap = { sequential:'ìˆœì„œ', reverse:'ì—­ìˆœ', random:'ëœë¤' };
  document.getElementById('modeBadge').textContent = 'Task ' + state.task + ' Â· ' + modeMap[state.settings.order];
  const typeMap = { cloze:'Keyword Cloze', structure:'Structure Recall', paraphrase:'Paraphrase' };
  const tb = document.getElementById('cardTypeBadge');
  tb.textContent = typeMap[card.type];
  tb.className = 'card-type-badge badge-' + card.type;
  document.getElementById('cardSection').textContent = card.section;
  const bk = state.bookmarks[state.task+'-'+idx];
  const bb = document.getElementById('bookmarkBtn');
  bb.textContent = bk ? 'â˜…' : 'â˜†';
  bb.classList.toggle('active', !!bk);
  const q = document.getElementById('cardQuestion');
  const qHtml = '<div style="font-size:12px;color:var(--text-muted);margin-bottom:10px;">' + card.question + '</div>';
  if (state.settings.direction === 'forward') {
    q.innerHTML = qHtml + renderPrompt(card.prompt);
  } else {
    q.innerHTML = '<div style="font-size:12px;color:var(--text-muted);margin-bottom:10px;">ì´ ë¬¸ì¥ì˜ ë¹ˆì¹¸ì„ ì±„ìš°ì„¸ìš” <span style="color:var(--accent)">(íŒíŠ¸: ' + card.hint + ')</span></div>' + renderPrompt(card.prompt);
  }
  const fb = document.getElementById('feedback');
  fb.className = 'feedback'; fb.style.display = 'none';
  document.getElementById('hintText').className = 'hint-text';
  const inp = document.getElementById('answerInput');
  inp.value = ''; inp.className = 'answer-input'; inp.disabled = false;
  document.getElementById('actionBtns').style.display = 'grid';
  document.getElementById('nextBtns').style.display = 'none';
  const cardEl = document.getElementById('quizCard');
  cardEl.style.animation = 'none'; cardEl.offsetHeight; cardEl.style.animation = '';
  inp.focus();
}

function renderPrompt(prompt) {
  return '<div style="font-size:15px;line-height:2.1;">' +
    prompt.replace(/\[\[___\]\]/g, '<span class="blank">?</span>') + '</div>';
}

function renderFilled(prompt, blanks, isCorrect) {
  let i = 0;
  const cls = isCorrect ? 'revealed' : 'wrong-reveal';
  return '<div style="font-size:15px;line-height:2.1;">' +
    prompt.replace(/\[\[___\]\]/g, () => '<span class="blank ' + cls + '">' + (blanks[i++]||'?') + '</span>') + '</div>';
}

function checkAnswer() {
  if (state.answered) return;
  const idx = state.queue[state.cursor];
  const card = state.deck[idx];
  const userAns = document.getElementById('answerInput').value.trim();
  if (!userAns) { revealAnswer(card, false, true); return; }
  const norm = s => s.toLowerCase().replace(/['''""`\-]/g,'').replace(/\s+/g,' ').trim();
  const allPresent = card.blanks.every(b => norm(userAns).includes(norm(b)));
  revealAnswer(card, allPresent, false);
}

function revealAnswer(card, isCorrect, skipped) {
  state.answered = true;
  const idx = state.queue[state.cursor];
  if (!skipped) {
    if (isCorrect) state.correctCount++;
    else { state.wrongCount++; if (state.settings.retry === 'on') state.wrongPool.push(idx); }
  } else { state.wrongCount++; state.wrongPool.push(idx); }
  const inp = document.getElementById('answerInput');
  inp.disabled = true;
  if (!skipped) inp.className = 'answer-input ' + (isCorrect ? 'correct' : 'incorrect');
  const q = document.getElementById('cardQuestion');
  const qHtml = '<div style="font-size:12px;color:var(--text-muted);margin-bottom:10px;">' + card.question + '</div>';
  if (!skipped) q.innerHTML = qHtml + renderFilled(card.prompt, card.blanks, isCorrect);
  const fb = document.getElementById('feedback');
  fb.className = 'feedback show ' + (isCorrect && !skipped ? 'correct-fb' : 'wrong-fb');
  fb.style.display = 'block';
  let hl = card.fullSentence;
  card.blanks.forEach(b => {
    hl = hl.replace(new RegExp('(' + b.replace(/[.*+?^${}()|[\]\\]/g,'\\$&') + ')', 'gi'), '<span class="highlight">$1</span>');
  });
  document.getElementById('feedbackText').innerHTML =
    '<div class="answer-label">' + (skipped ? 'ê±´ë„ˆëœ€' : isCorrect ? 'âœ“ ì •ë‹µ!' : 'âœ— ì˜¤ë‹µ') + '</div>' +
    '<div class="answer-text">' + hl + '</div>';
  document.getElementById('actionBtns').style.display = 'none';
  document.getElementById('nextBtns').style.display = 'grid';
}

function showHint() {
  const card = state.deck[state.queue[state.cursor]];
  const h = document.getElementById('hintText');
  h.textContent = 'ğŸ’¡ ' + card.hint;
  h.className = 'hint-text show';
}

function skipCard() {
  revealAnswer(state.deck[state.queue[state.cursor]], false, true);
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    if (state.answered) nextCard(); else checkAnswer();
  }
}

function nextCard() {
  state.cursor++;
  if (state.cursor >= state.queue.length) showResult();
  else loadCard();
}

function toggleBookmark() {
  const idx = state.queue[state.cursor];
  const key = state.task + '-' + idx;
  state.bookmarks[key] = !state.bookmarks[key];
  localStorage.setItem('bm_s2', JSON.stringify(state.bookmarks));
  const bb = document.getElementById('bookmarkBtn');
  bb.textContent = state.bookmarks[key] ? 'â˜…' : 'â˜†';
  bb.classList.toggle('active', !!state.bookmarks[key]);
}

function showResult() {
  const total = state.queue.length;
  const rate = total > 0 ? Math.round(state.correctCount / total * 100) : 0;
  document.getElementById('resultEmoji').textContent = rate >= 90 ? 'ğŸ†' : rate >= 70 ? 'ğŸ¯' : rate >= 50 ? 'ğŸ“š' : 'ğŸ’ª';
  document.getElementById('resultTitle').textContent = rate >= 90 ? 'ì™„ë²½!' : rate >= 70 ? 'ì˜í–ˆì–´ìš”!' : rate >= 50 ? 'ê³„ì† ë„ì „!' : 'ë‹¤ì‹œ ë„ì „!';
  document.getElementById('resultSub').textContent = 'Task ' + state.task + ' Â· ' + {sequential:'ìˆœì„œ',reverse:'ì—­ìˆœ',random:'ëœë¤'}[state.settings.order] + ' ëª¨ë“œ';
  document.getElementById('statCorrect').textContent = state.correctCount;
  document.getElementById('statWrong').textContent = state.wrongCount;
  document.getElementById('statRate').textContent = rate + '%';
  const wl = document.getElementById('wrongList');
  const rb = document.getElementById('retryWrongBtn');
  if (state.wrongPool.length > 0) {
    wl.style.display = 'block'; rb.style.display = 'flex';
    document.getElementById('wrongItems').innerHTML = state.wrongPool.map(i => {
      const c = state.deck[i];
      return '<div class="wrong-item"><span class="wi-section">' + c.section + '</span> ' + c.question + '</div>';
    }).join('');
  } else { wl.style.display = 'none'; rb.style.display = 'none'; }
  showScreen('resultScreen');
}

function retryWrong() { startTask(state.task, true, state.wrongPool.map(i => state.deck[i])); }
function retryAll() { startTask(state.task, false, null); }
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goHome() { showScreen('homeScreen'); }
</script>
</body>
</html>
